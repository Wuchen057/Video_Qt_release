
---

# 大视野高精度的靶标位姿测量与追踪系统 (Video_Qt_release)

本项目是一个基于双目视觉的工业级位姿解算系统，核心功能包括：高频率相机同步采集、圆形标记点亚像素检测、透视偏差修正、高可靠性点云匹配以及三维运动轨迹实时可视化。

## 🛠 开发环境配置

### 1. 核心依赖库
*   **OpenCV (Release 版)**: 用于图像处理、相机去畸变、PnP位姿解算。
*   **Ceres Solver (Release 版)**: 用于非线性优化。
    *   参考配置：[Ceres 安装教程](https://www.cnblogs.com/zsgyx/p/10920418.html)
*   **Qt**: 用于构建 UI 界面。
    *   安装步骤：安装 Qt 环境后，在 Visual Studio 中安装 **Qt VS Tools** 插件。
*   **OpenGL**: 用于三维轨迹的可视化渲染。
    *   参考配置：[OpenGL 环境搭建](https://zhuanlan.zhihu.com/p/283696937)

### 2. 硬件支持
*   支持双相机（软件触发同步采集）。
*   相机亮度建议设置在 100-300 之间，以获得最佳检测效果。

---

## 🚀 核心技术特性

### 1. 亚像素圆形标记点解算
*   **透视偏差修正 (Perspective Bias Correction)**: 采用“迭代修正法”。通过初步位姿建立虚拟 3D 圆并反向投影，计算投影中心与圆心偏差向量，显著提升了近距离测量的精度。
*   **鲁棒提取流程**: 结合圆度、凸度、轮廓面积的多级筛选，以及灰度离群值和距离离群值的双重过滤，支持高曝光环境下的稳定提取。

### 2. 高可靠性点匹配算法
*   **骨架向量匹配**: 针对具有对称性的 14 点标记板，弃用绝对坐标排序，改用基于几何拓扑关系的“骨架向量”进行相对位置匹配，支持任意角度（旋转/倒置）的稳定识别。
*   **双假设 PnP 校验**: 针对共面点带来的镜像模糊（Mirror Ambiguity），提取非共线“翅膀点”进行双假设测试，通过重投影误差自动筛选最优解。

### 3. 高性能系统架构
*   **计算加速**: 引入查表法 (LUT) 去畸变、并行化 `grab()` 采集、SOLVEPNP_IPPE 算法提升解算速度。
*   **内存优化**: 建立了 `gray_cache_`、`contours_cache_`、`mask_buffer_` 等内存池，消除了频繁的 `malloc/free` 造成的卡顿。
*   **UI 响应**: 引入 Pre-Resize 机制，在图像转换前完成缩放，极大降低了主线程负载。

---

## 📅 项目更新日志 (Changelog)

### 2025-12-26: 逻辑架构重大升级
- **修正点匹配逻辑**: 解决了对称点导致的 X 轴匹配错误。
- **引入双假设 PnP**: 针对 3D 空间共面点引发的镜像问题，通过非共线点回溯匹配，确保 14 个点位 ID 的绝对唯一性。

### 2025-12-16 ~ 12-22: 功能扩展与持久化
- **视频目标测量**: 新增 `VideoPoseApp` 模块，支持离线视频的位姿回溯测量。
- **数据导出**: 实现了位姿数据及重投影误差自动保存至 `.txt` 文件功能。
- **可视化**: 轨迹记录功能与视频测量系统完成深度集成。

### 2025-12-10 ~ 12-15: 极致性能优化
- **架构层**: 并行触发双相机采集，实现图像处理逻辑与采集逻辑解耦。
- **算法层**: 在 `Camera` 类中引入 `remap` 替代实时去畸变。
- **缓存层**: 新增 `blurred_cache_` 和 `element_kernel_`，消除核心循环中的资源申请开销。
- **环境适配**: 加入内亮外暗逻辑，成功排除复杂背景（如石膏像）的噪点干扰。

### 2025-12-09: 3D 可视化
- **OpenGL 集成**: 实现了靶标运动轨迹的三维实时渲染功能（详见 `main02`）。

### 2025-11-28 ~ 12-05: 精度攻坚
- **软件同步**: 修改 `camerasystemapp.cpp` 确保双目采集时效一致。
- **精度修正**: 首次引入 **迭代修正法** 解决圆形标记点的透视偏差问题，提升测量一致性。

---

## 📂 项目结构说明
- `CameraSystemApp`: 核心逻辑调度与 UI 交互。
- `ImageProcessor`: 图像预处理、轮廓提取与滤波逻辑。
- `PoseEstimator`: 包含 PnP 解算、透视偏差修正及镜像校验。
- `MeasurementManager`: 管理测量数据、轨迹记录与文件 I/O。
- `Trajectory3DPlotter`: OpenGL 三维渲染引擎。

---
*Generated by Git Repo Administrator*
